// Generated by CoffeeScript 1.12.7
(function() {
  var checkCurrentPage, updateActiveTab, update_icon;

  update_icon = function(has_color, tab_id) {
    return browser.browserAction.setIcon({
      path: has_color ? {
        48: '../pic/cn_1.png'
      } : {
        48: '../pic/cn_0.png'
      },
      tabId: tab_id
    });
  };

  checkCurrentPage = function(tab) {
    return get_item({
      url: tab.url
    }, function(result) {
      if (result['stat'] === Status.COMPLETE) {
        return update_icon(true, tab.id);
      } else if (result['stat'] === Status.ERROR) {
        return update_icon(false, tab.id);
      }
    });
  };

  updateActiveTab = function() {
    return browser.tabs.query({
      active: true,
      currentWindow: true
    }).then(function(tabs) {
      if (tabs[0]) {
        return checkCurrentPage(tabs[0]);
      }
    });
  };

  browser.tabs.onUpdated.addListener(updateActiveTab);

  browser.tabs.onActivated.addListener(updateActiveTab);

}).call(this);
